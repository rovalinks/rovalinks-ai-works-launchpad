name: Test Subscriber Update

on:
  workflow_dispatch:

jobs:
  test-update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install pandas
        run: pip install pandas

      - name: Update CSV
        run: |
          cat <<EOF | python3
import os
import pandas as pd
from datetime import datetime

email = "test@example.com"
file_path = "subscribers/users.csv"

if os.path.exists(file_path):
    df = pd.read_csv(file_path)
else:
    df = pd.DataFrame(columns=["email", "timestamp"])

if email not in df["email"].values:
    df.loc[len(df)] = [email, datetime.utcnow().isoformat()]
    df.to_csv(file_path, index=False)
EOF
